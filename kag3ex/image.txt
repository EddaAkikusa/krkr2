Title: 吉里吉里/KAGEX データ形式に関するメモ
Author: 合資会社ワムソフト 渡邊剛

●立ち絵データの考え方

(0)レベル
　立ち位置の前後位置でデータを別に準備する

(1)ポーズ　
　基本的なシルエットが同じになるもの
　表情パターンを基本的に使いまわしできるもの

(2)服装
　あるポーズにおける服装のバリエーション

(3)表情
　あるポーズにおける表情のバリエーション

●遠近レベル処理

遠近処理を使う場合にはレベル指定の項目を追加します。
レベルごとに拡大・縮小した全画像を準備し、ファイル名にレベル指定部分を
追加します。

◇設定方法

　1. 奥にある部分から順に 0 から順に番号をわりあてます
  2. envinit.tjs で levels の設定を行います。
    パラメータ zoom 
　　　指定されたレベルの画像が　標準:移動量がピクセル値と同じになる位置　に
　　　対して何％のサイズの画像になっているかを指定します。座標の補正に
　　　つかわれます。
　　パラメータ name
      画像ファイル名指定 (imageName や faceImageName) の LEVEL の部分に
　　　差し込む名称を指定します。

  3, positions に、目的のレベルに合致した名前を登録します

# サンプルの場合
# 0:奥  1:前  2:手前　　と登録して、1 をデフォルト (defaultLevel) に指定
# ただし、ファイル名は、前に登録したものにあわせて以下のように調整してあります
# 奥: hoge_1_X_X.png  もとの画像の60%サイズ
# 前: hoge_0_X_X.png  通常時の画像
# 前: hoge_2_X_X.png  もとの画像の120% サイズ

●表情合成の方式

データの作り方としては２つのバリエーションが使えます

A.表情合成方式

 基本画像: (1)×(2) の組み合わせ
 表情画像: 表情画像の上に合成する差分 (3) を (1) の種類だけ準備

B.単体方式
 (1)×(2)×(3) 全パターンを作る

例　(ここではレベルについては無視してあります)
    ポーズ　1:正面 2:斜め
　　服装    1:制服 2:私服
    表情    0:通常 1:喜 2:怒 3:哀

A.表情合成方式の場合

ベース画像
 img1_1_0  正面制服・通常
 img1_2_0  正面私服・通常
 img2_1_0  斜め制服・通常
 img2_2_0　斜め私服・通常
表情差分
 img1_0_1  正面・喜（合成用）
 img1_0_2  正面・怒（合成用）
 img1_0_2  正面・哀（合成用）
 img2_0_1  斜め・喜（合成用）
 img2_0_2  斜め・怒（合成用）
 img2_0_2  斜め・哀（合成用）
 
B.単体別方式の場合

ベース画像
 img1_1_0  正面制服・通常
 img1_2_0  正面私服・通常
 img2_1_0  斜め制服・通常
 img2_2_0　斜め私服・通常
 img1_1_1  正面制服・喜
 img1_2_1  正面私服・喜
 img2_1_1  斜め制服・喜
 img2_2_1　斜め私服・喜
 img1_1_2  正面制服・怒
 img1_2_2  正面私服・怒
 img2_1_2  斜め制服・怒
 img2_2_2　斜め私服・怒
 img1_1_3  正面制服・哀
 img1_2_3  正面私服・哀
 img2_1_3  斜め制服・哀
 img2_2_3　斜め私服・哀

◇設定方法

1. 表情合成方式

パラメータ faceImageName が定義されてあるとこのロジックで動作します。

 1. ポーズと服装の組み合わせでベースになる画像を検出します
 2. その画像に表情部分の画像を合成します
 3. 合成済みの画像を立ち絵として表示します。

 表情ファイルはポーズごとにずれないように調整したものを準備する必要があります。
 同じポーズの中で表情ファイルを使いまわしされます。

2. 表情統合方式

パラメータ　faceImageName　を定義しないとこのロジックで動作します。

この場合には表情画像の合成の必要が無いため、ポーズ/服装間で形状が全然
別物になっていても問題ないため、「ポーズ」「服装」のいずれかを使う必要が
ありません。

1. 「ポーズ」は未指定（１つだけ）で「服装」と「表情」のみの切り替えで対応する

　ポーズのパラメータ　　の中に DRESS と FACE を両方含めます

2. 服装は未指定とし、「ポーズ」と「表情」の切り替えで対応する

　ポーズのパラメータ　　の中に FACE のみを含めます。

●立ち絵データの作成について

立ち絵データの原点位置は画像の「下端中央」になります。

データ作成時の注意事項

(1) 全キャラクタに対して「足元」の位置をあわせておく

(2) 個別のキャラに分割

　　☆画像の下端はトリミングしてはいけない（原点がずれるため）
　　☆画面の上端は任意にトリミングしてかまわない

(3) キャラクタ別の立ち絵の左右位置調整

　　あるキャラクタのすべてのバリエーションの
　　立ち絵についてセンター位置をあわせておくきます。
　　このあと、個別のポーズについて、左右のトリミングを
　　行ってもかまいませんが、センターがずれないように
　　注意する必要があります。（左右同じ量づつトリミングする必要がある）

(3) 表情のレイヤはベースのレイヤと同じサイズで作成します。
　
　　これは表情の座標を適切にあわせるためです。
　　フォトショップの場合「WEB用に保存」を使えばベースレイヤと
　　同じサイズのままPNGで出力できます。

  　PNG 形式の場合は、off_x off_y を適切に残すことが可能なら
    トリミングしてもかまいません。
	例: imagemagik を使用してトリミング
    > mogrify -trim *.png
